<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Testudo ‚Äì Digitaler Entscheidungshelfer</title>
  <style>
    /* ===== Testudo Design ===== */
    :root{
      --cream:#fbf4e8;
      --navy:#0f2230;
      --ink:#10222b;
      --muted:#6b7b86;
      --line:#e9e1d6;
      --accent:#2f8b6a;    /* Testudo-Gr√ºn */
      --accent-2:#1c6f9f;  /* sekund√§rer Akzent */
      --card:#ffffff;
      --radius:20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--cream);color:var(--ink);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      display:flex;align-items:center;justify-content:center;padding:28px;
    }
    .app{
      width:min(980px,100%);
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:0 18px 50px rgba(16,34,43,.08);
      overflow:hidden;
    }
    header{
      display:flex;gap:16px;align-items:center;justify-content:space-between;
      padding:18px 22px;border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,#ffffff, #fffaf3);
    }
    .brand{
      display:flex;gap:14px;align-items:center;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;overflow:hidden;background:#e9f5ef;
      display:grid;place-items:center;border:1px solid #dfeee6;
      font-weight:800;color:var(--accent);
    }
    .title{font-weight:800;font-size:1.25rem;color:var(--navy);letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:.95rem}
    .progress{height:8px;background:#f2eadd;margin:0 22px 18px;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .25s ease}
    main{padding:22px}
    .qhead{font-size:1.5rem;line-height:1.25;font-weight:800;color:var(--navy);margin:4px 0 8px}
    .qsub{color:var(--muted);margin-bottom:18px}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(210px,1fr))}
    .opt{
      padding:14px;border:1px solid var(--line);border-radius:14px;background:#fff;cursor:pointer;
      transition:.15s ease; user-select:none;
    }
    .opt:hover{transform:translateY(-2px);box-shadow:0 10px 26px rgba(16,34,43,.05)}
    .opt.selected{outline:2px solid var(--accent);background:#f4fbf7}
    .opt input{display:none}
    .controls{display:flex;justify-content:space-between;gap:10px;margin-top:22px}
    .btn{
      padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:#fff;color:var(--navy);
      font-weight:700;cursor:pointer
    }
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#ffffff}
    .btn[disabled]{opacity:.45;cursor:default}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .summary{display:none}
    .tag{display:inline-flex;align-items:center;gap:8px;background:#f7f3eb;border:1px solid var(--line);border-radius:999px;padding:8px 12px;margin:6px 6px 0 0;font-size:.92rem}
    .hr{height:1px;background:var(--line);margin:18px 0}
    .hidden{display:none !important}
    /* Inputs */
    .field{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .input{
      height:44px;border-radius:12px;border:1px solid var(--line);padding:0 12px;min-width:120px;
      font-size:1rem;background:#fff;color:var(--ink)
    }
    .hint{font-size:.9rem;color:var(--muted);margin-top:6px}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="brand">
        <!-- ersetze src durch /assets/testudo.png, wenn du ein Bild hast -->
        <div class="logo">üê¢</div>
        <div>
          <div class="title">Testudo</div>
          <div class="subtitle">Conversational UI for Insurance</div>
        </div>
      </div>
    </header>
    <div class="progress"><div class="bar" id="bar"></div></div>

    <main>
      <div id="question"></div>

      <div class="controls">
        <button class="btn" id="prevBtn">Zur√ºck</button>
        <div class="row">
          <button class="btn" id="skipBtn">Ich wei√ü es nicht</button>
          <button class="btn primary" id="nextBtn">Weiter</button>
        </div>
      </div>

      <section class="summary" id="summary">
        <h2 style="margin:10px 0 6px;color:var(--navy)">Zusammenfassung</h2>
        <div id="answers"></div>
        <div class="hr"></div>
        <p class="hint">Hinweis: Die finale Empfehlung (z. B. ‚ÄûGKV + Zahnzusatz‚Äú) kann auf Basis dieser Antworten berechnet und als Ergebnis-Karte angezeigt werden.</p>
      </section>
    </main>
  </div>

  <script>
    // ===== Fragen (angepasst; Kinder-Flow mit Anzahl & optionale Altersauswahl) =====
    // types: single | multi | yesno | number
    const QUESTIONS = [
      { id:"age", title:"Wie alt sind Sie?", type:"single",
        options:["18‚Äì29","30‚Äì39","40‚Äì59","ab 60"], required:true },

      { id:"job", title:"Was ist Ihr aktueller Beruf?", type:"single",
        options:["Auszubildender/Student","Angestellter","Selbstst√§ndig","Beamter","Arbeitslos","Rente"], required:true },

      { id:"jobIntensity", title:"Wie k√∂rperlich intensiv ist Ihr Beruf?", type:"single",
        options:["√ºberwiegend sitzend","teilweise k√∂rperlich","stark k√∂rperlich"], required:false },

      { id:"income", title:"Wie hoch ist Ihr j√§hrliches Bruttoeinkommen?", type:"single",
        subtitle:"Hinweis: Wechsel in PKV in der Regel erst ab JAEG (~69.300 ‚Ç¨) m√∂glich.",
        options:["Unter 20.000 ‚Ç¨","20.001‚Äì40.000 ‚Ç¨","40.001‚Äì69.299 ‚Ç¨","√úber 69.300 ‚Ç¨"], required:true },

      { id:"family", title:"Familienstand?", type:"single",
        options:["ledig","verheiratet","in Partnerschaft","geschieden","verwitwet"], required:true },

      { id:"hasKids", title:"Haben Sie Kinder?", type:"yesno", required:true },

      // NEU: Anzahl Kinder (verhindert Blockade)
      { id:"kidsCount", title:"Wie viele Kinder m√∂chten Sie (mit)versichern?", type:"number",
        min:1, max:10, placeholder:"Anzahl", required:true,
        visibleIf:(a)=> a.hasKids==="Ja" },

      // Altersangaben optional ‚Äì blockiert ‚ÄûWeiter‚Äú nicht mehr
      { id:"kidsAge", title:"Wie alt ist / sind Ihr(e) Kind(er)? (optional)", type:"multi",
        options:["unter 6 Jahre","6‚Äì17 Jahre","18‚Äì25 Jahre","√ºber 25 Jahre"],
        required:false,
        visibleIf:(a)=> a.hasKids==="Ja" },

      { id:"kidsIns", title:"Wie sind Ihr(e) Kind(er) derzeit versichert?", type:"single",
        options:["√ºber meine GKV","√ºber eine PKV","aktuell nicht versichert"],
        required:false,
        visibleIf:(a)=> a.hasKids==="Ja" },

      { id:"chronic", title:"Haben Sie chronische Erkrankungen?", type:"yesno", required:false },

      { id:"addonsImportant", title:"Sind Ihnen Zusatzleistungen wichtig?", type:"single",
        options:["Ja","Nein","Ich wei√ü es nicht"], required:false },

      { id:"addonsPick", title:"Welche Zusatzleistungen sind wichtig? (Mehrfachauswahl, optional)",
        type:"multi",
        options:["Krankenhaus-Komfort","Zahn & Prophylaxe","Sehhilfen & Brillen","Heilmethoden","Einkommensschutz (Krankentagegeld)","Pflegevorsorge","Reisen","Ambulant & Pr√§vention"],
        required:false,
        visibleIf:(a)=> a.addonsImportant==="Ja" }
    ];

    // ===== Wizard-Logik =====
    const state = { step:0, order:[], answers:{} };

    function recomputeOrder(){
      const a = state.answers;
      state.order = QUESTIONS.filter(q => !q.visibleIf || q.visibleIf(a));
      if(state.step >= state.order.length) state.step = state.order.length-1;
      updateProgress();
    }

    function render(){
      recomputeOrder();
      const q = state.order[state.step];
      const qEl = document.getElementById('question');
      if(!q){ showSummary(); return; }

      const subtitle = q.subtitle ? `<div class="qsub">${q.subtitle}</div>` : "";
      let body = "";

      const current = state.answers[q.id];

      // Helpers
      const opt = (label, selected) =>
        `<label class="opt ${selected?'selected':''}" data-value="${label}">
           <input type="checkbox"/> ${label}
         </label>`;

      // Render by type
      if(q.type==='single'){
        body = `<div class="grid">${
          q.options.map(o => {
            const s = current===o;
            return `<label class="opt ${s?'selected':''}" data-value="${o}">
                      <input type="radio" name="${q.id}"/> ${o}
                    </label>`;
          }).join("")
        }</div>`;
      }
      else if(q.type==='multi'){
        const cur = Array.isArray(current) ? current : [];
        body = `<div class="grid">${
          q.options.map(o => opt(o, cur.includes(o))).join("")
        }</div>`;
      }
      else if(q.type==='yesno'){
        const opts = ["Ja","Nein"];
        body = `<div class="grid">${
          opts.map(o => {
            const s = current===o;
            return `<label class="opt ${s?'selected':''}" data-value="${o}">
                      <input type="radio" name="${q.id}"/> ${o}
                    </label>`;
          }).join("")
        }</div>`;
      }
      else if(q.type==='number'){
        const val = (typeof current==='number') ? current : "";
        body = `
          <div class="field">
            <input id="num-${q.id}" class="input" type="number"
                   min="${q.min||0}" max="${q.max||999}"
                   placeholder="${q.placeholder||''}" value="${val}">
          </div>
          <div class="hint">Zahl eingeben und ‚ÄûWeiter‚Äú klicken.</div>
        `;
      }

      qEl.innerHTML = `
        <div class="qhead">${q.title}</div>
        ${subtitle}
        ${body}
      `;

      // Interaktionen
      if(q.type==='multi' || q.type==='single' || q.type==='yesno'){
        qEl.querySelectorAll('.opt').forEach(el=>{
          el.addEventListener('click', ()=>{
            const value = el.dataset.value;
            if(q.type==='multi'){
              const arr = Array.isArray(state.answers[q.id]) ? [...state.answers[q.id]] : [];
              const i = arr.indexOf(value);
              if(i>=0) arr.splice(i,1); else arr.push(value);
              state.answers[q.id] = arr;
              el.classList.toggle('selected');
            }else{
              state.answers[q.id] = value;
              qEl.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));
              el.classList.add('selected');
            }
            updateButtons();
          });
        });
      }
      if(q.type==='number'){
        const input = document.getElementById(`num-${q.id}`);
        input.addEventListener('input', ()=>{
          const n = input.value === "" ? "" : Number(input.value);
          state.answers[q.id] = (input.value==="" ? "" : n);
          updateButtons();
        });
      }

      updateButtons();
      updateProgress();
      hideSummary();
    }

    function currentAnswered(){
      const q = state.order[state.step];
      if(!q) return true;
      const v = state.answers[q.id];

      // Optional? ‚Üí immer ok
      if(q.required === false) return true;

      if(q.type==='multi') return Array.isArray(v) && v.length>0;
      if(q.type==='number'){
        if(v==="" || v===undefined || v===null) return false;
        const n = Number(v);
        if(Number.isNaN(n)) return false;
        if(q.min!==undefined && n<q.min) return false;
        if(q.max!==undefined && n>q.max) return false;
        return true;
      }
      return !!v;
    }

    function updateButtons(){
      document.getElementById('prevBtn').disabled = state.step===0;
      document.getElementById('nextBtn').disabled = !currentAnswered();
    }

    function updateProgress(){
      const pct = Math.max(0, Math.min(100, Math.round((state.step)/Math.max(1,state.order.length)*100)));
      document.getElementById('bar').style.width = `${pct}%`;
    }

    function showSummary(){
      document.getElementById('question').classList.add('hidden');
      document.querySelector('.controls').classList.add('hidden');
      const s = document.getElementById('summary');
      const box = document.getElementById('answers');
      s.style.display = 'block';
      box.innerHTML = Object.entries(state.answers).map(([k,v])=>{
        const q = QUESTIONS.find(x=>x.id===k);
        const val = Array.isArray(v) ? v.join(", ") : (v===undefined||v==="" ? "‚Äî" : v);
        return `<div class="tag"><strong>${q?.title||k}:</strong>&nbsp; ${val}</div>`;
      }).join("");
      document.getElementById('bar').style.width = "100%";
    }
    function hideSummary(){
      document.getElementById('summary').style.display = 'none';
      document.getElementById('question').classList.remove('hidden');
      document.querySelector('.controls').classList.remove('hidden');
    }

    // Navigation
    document.getElementById('prevBtn').addEventListener('click', ()=>{
      if(state.step>0){ state.step--; render(); }
    });
    document.getElementById('nextBtn').addEventListener('click', ()=>{
      if(state.step < state.order.length-1){ state.step++; render(); }
      else showSummary();
    });
    document.getElementById('skipBtn').addEventListener('click', ()=>{
      const q = state.order[state.step];
      if(q && q.required!==true){ state.answers[q.id] = "Ich wei√ü es nicht"; }
      if(state.step < state.order.length-1){ state.step++; render(); }
      else showSummary();
    });

    // Start
    (function start(){ recomputeOrder(); render(); })();
  </script>
</body>
</html>
