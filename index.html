<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Testudo – Entscheidungsassistent</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap');

    :root{
      color-scheme: dark;
      --brand:#A7D37B;            /* Hauptfarbe */
      --brand2:#2E6B58;           /* dunkleres Grün */
      --bg:#040810; --bg-soft:rgba(11,20,39,.78); --panel:rgba(12,24,50,.86);
      --text:#f2f6ff; --muted:#9fb2cd; --line:rgba(255,255,255,.08);
      --r-lg:26px; --r-md:18px; --r-sm:12px;
      --shadow:0 32px 80px rgba(5,11,25,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
      padding:clamp(20px,4vw,48px);font-family:Manrope,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: radial-gradient(circle at 15% -10%, rgba(167,211,123,.25), transparent 42%),
                  radial-gradient(circle at 90% 15%, rgba(46,107,88,.25), transparent 45%),
                  radial-gradient(ellipse at bottom, rgba(46,107,88,.2), transparent 60%),
                  var(--bg);
      color:var(--text); overflow:hidden;
    }
    .shell{width:min(1100px,100%);display:flex;flex-direction:column;gap:24px;position:relative;z-index:1}
    header.masthead{display:flex;gap:18px;align-items:center;justify-content:space-between;padding:clamp(18px,4vw,28px);
      background:var(--bg-soft);backdrop-filter:blur(18px);border:1px solid rgba(255,255,255,.05);border-radius:var(--r-lg);box-shadow:var(--shadow)}
    .brand{display:flex;gap:16px;align-items:center}
    .logo-img{width:150px;height:auto;object-fit:contain;border-radius:12px}
    .eyebrow{text-transform:uppercase;letter-spacing:.24em;font-size:.7rem;color:rgba(255,255,255,.65);margin:0 0 4px}
    .headline{margin:0;font-size:clamp(1.6rem,4vw,2.2rem);font-weight:800;letter-spacing:-.01em}
    .lede{margin:8px 0 0;max-width:520px;color:var(--muted);font-size:.98rem;line-height:1.6}
    .mast-actions{display:flex;gap:10px;align-items:center}
    .btn{padding:11px 16px;border-radius:12px;border:1px solid var(--line);background:rgba(6,15,30,.7);color:var(--text);cursor:pointer;font-weight:700}
    .btn.primary{border:none;color:#0b1a11;background:var(--brand)}
    .btn:hover{transform:translateY(-1px)}
    .app{background:var(--panel);border-radius:var(--r-lg);box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.05);overflow:hidden}
    .app-header{padding:clamp(18px,4vw,28px) clamp(20px,5vw,36px) 12px;border-bottom:1px solid rgba(255,255,255,.06);
      background:linear-gradient(160deg,rgba(11,29,56,.85),rgba(11,22,44,.7))}
    .label{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-size:.8rem;letter-spacing:.08em;text-transform:uppercase;background:rgba(167,211,123,.18);color:#101b10;border:1px solid rgba(167,211,123,.5)}
    .wizard-title{margin:10px 0 6px;font-size:clamp(1.3rem,3vw,1.8rem);font-weight:800}
    .wizard-subtitle{margin:0;color:var(--muted);max-width:560px;line-height:1.6;font-size:.95rem}
    .progress{height:9px;margin-top:20px;background:rgba(255,255,255,.07);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2));border-radius:inherit;transition:width .3s ease}

    main{padding:clamp(20px,4vw,32px)}
    .qhead{font-size:clamp(1.1rem,2.7vw,1.5rem);font-weight:800;margin:0 0 10px}
    .qsub{color:var(--muted);margin:0 0 18px;font-size:.92rem}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .opt{border-radius:16px;padding:16px;background:rgba(7,15,32,.65);border:1px solid var(--line);cursor:pointer;user-select:none}
    .opt.selected{border:1px solid rgba(167,211,123,.85);background:linear-gradient(140deg,rgba(167,211,123,.18),rgba(46,107,88,.12))}
    .opt input{display:none}
    .hint{color:var(--muted);font-size:.88rem;margin:8px 0 0}
    .controls{display:flex;justify-content:space-between;gap:12px;margin-top:18px;flex-wrap:wrap}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .summary{display:none;margin-top:18px}
    .card{border:1px solid var(--line);border-radius:16px;background:rgba(6,14,28,.7);padding:16px}
    .tag{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:rgba(8,19,36,.85);margin:6px 6px 0 0}
    .hr{height:1px;background:var(--line);margin:18px 0}
    .note{color:#ffe08a}

    @media (max-width:640px){.masthead{flex-direction:column;align-items:flex-start}.btn,.row .btn{width:100%}}
  </style>
</head>
<body>
  <div class="shell">
    <header class="masthead">
      <div class="brand">
        <img class="logo-img" src="./assets/Testudo.png" alt="Testudo Logo">
        <div>
          <p class="eyebrow">Testudo</p>
          <h1 class="headline">Conversational UI for Insurance</h1>
          <p class="lede">Digitaler Entscheidungshelfer, der Interessenten strukturiert zu passenden Gesundheitsversicherungen führt.</p>
        </div>
      </div>
      <div class="mast-actions">
        <button class="btn" id="restartTop">Neu starten</button>
      </div>
    </header>

    <div class="app" id="app">
      <div class="app-header">
        <span class="label">Onboarding Wizard</span>
        <h2 class="wizard-title">Ihre Antworten führen zur Empfehlung</h2>
        <p class="wizard-subtitle">Beantworten Sie die Fragen nacheinander. Sie können zurückspringen oder überspringen.</p>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>

      <main>
        <div id="question"></div>

        <div class="controls">
          <button class="btn" id="prevBtn">Zurück</button>
          <div class="row">
            <button class="btn" id="skipBtn">Ich weiß es nicht</button>
            <button class="btn primary" id="nextBtn">Weiter</button>
          </div>
        </div>

        <section class="summary" id="summary">
          <h2 style="margin:6px 0 10px">Zusammenfassung Ihrer Angaben</h2>
          <div id="answers" class="card" style="margin-bottom:12px"></div>

          <div id="unknownNote" class="card" style="display:none;background:rgba(255,196,0,.1);border-color:rgba(255,196,0,.35);color:#ffe9a6;margin-top:10px">
            ⚠️ Einige Antworten wurden mit „Ich weiß es nicht“ angegeben. Sie können diese Fragen erneut durchgehen, um eine präzisere Empfehlung zu erhalten.
          </div>

          <div class="hr"></div>
          <div id="recommendation" class="card"></div>
          <div class="row" style="margin-top:12px">
            <button class="btn" id="restartBottom">Neu starten</button>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // ——— Fragenkatalog inkl. Unterauswahlen für Zusatzleistungen
    const QUESTIONS = [
      // Basis
      { id:"age", title:"Wie alt sind Sie?", type:"single",
        options:["18–29","30–39","40–59","ab 60"], required:true },

      { id:"occupation", title:"Was ist Ihr aktueller Beruf?", type:"single",
        options:["Beamter","Selbstständig","Angestellter","Auszubildender/Student","Arbeitslos","Rente"], required:true },

      { id:"income", title:"Wie hoch ist Ihr jährliches Bruttoeinkommen?", type:"single",
        options:["Unter 20.000 €","20.001–40.000 €","40.001–69.299 €","Über 69.300 €"], required:true },

      { id:"jobIntensity", title:"Wie körperlich intensiv ist Ihr Beruf?", type:"single",
        options:["überwiegend sitzend","teilweise körperlich","stark körperlich"] },

      // Zusatzleistungen (Stufe 1)
      { id:"extrasImportance", title:"Sind Ihnen Zusatzleistungen wichtig?", type:"yesno" },

      { id:"extrasSelection", title:"Bitte wählen Sie Zusatzleistungen aus, die Ihnen wichtig sind", type:"multi",
        visibleIf:a => a.extrasImportance==="Ja",
        options:["Zusätzliche Zahnleistungen","Zusätzliche Reiseversicherungen","Zusätzliche Krankenhausleistungen"] },

      // Unterauswahlen (Stufe 2)
      { id:"extrasTeeth", title:"Zusätzliche Zahnleistungen (Mehrfachauswahl möglich)", type:"multi",
        visibleIf:a => (a.extrasSelection||[]).includes("Zusätzliche Zahnleistungen"),
        options:["Zahnersatz","Prophylaxe","Zahnreinigung","Zahnfüllung","Zahnimplantate"] },

      { id:"extrasTravel", title:"Zusätzliche Reiseversicherungen (Mehrfachauswahl möglich)", type:"multi",
        visibleIf:a => (a.extrasSelection||[]).includes("Zusätzliche Reiseversicherungen"),
        options:["Reiserücktrittsversicherung","Reiseabbruchversicherung","Auslandskrankenversicherung","Reisegepäckversicherung","Reisehaftpflichtversicherung","Reiseunfallversicherung"] },

      { id:"extrasHospital", title:"Zusätzliche Krankenhausleistungen (Mehrfachauswahl möglich)", type:"multi",
        visibleIf:a => (a.extrasSelection||[]).includes("Zusätzliche Krankenhausleistungen"),
        options:["Krankenhaus-Komfort","Sehhilfen & Brille","Heilmethoden","Pflegevorsorge","Ambulant & Prävention"] },

      // Familie / Kinder (Multi nur bei Alter; Rest Single)
      { id:"maritalStatus", title:"Wie ist Ihr Familienstand?", type:"single",
        options:["Ledig","In Partnerschaft","Verheiratet","Geschieden","Verwitwet"], required:true },

      { id:"hasChildren", title:"Haben Sie Kinder?", type:"yesno", required:true },

      { id:"insureChildren", title:"Kinder mitversichern?", type:"yesno",
        visibleIf:a => a.hasChildren==="Ja" },

      { id:"childrenAge", title:"Wie alt ist/sind Ihr(e) Kind(er)? (Mehrfachauswahl möglich)", type:"multi",
        visibleIf:a => a.insureChildren==="Ja",
        options:["unter 6 Jahre","6–17 Jahre","18–25 Jahre","über 25 Jahre"] },

      { id:"childrenEducation", title:"Befinden sich Ihre Kinder in Ausbildung oder Studium?", type:"single",
        visibleIf:a => a.insureChildren==="Ja",
        options:["In der Schule","In Ausbildung","Im Studium","Nein"] },

      { id:"childrenInsurance", title:"Wie sind Ihr(e) Kind(er) derzeit versichert?", type:"single",
        visibleIf:a => a.insureChildren==="Ja",
        options:["über eine GKV","über eine PKV","aktuell nicht versichert"] },

      // Gesundheit / Lifestyle (gekürzt)
      { id:"chronicDiseases", title:"Haben Sie chronische Erkrankungen?", type:"yesno" },
      { id:"dangerousSports", title:"Üben Sie gefährliche Sportarten aus?", type:"yesno" },
      { id:"travel", title:"Reisen Sie regelmäßig?", type:"single",
        options:["Ja, innerhalb der EU","Ja, außerhalb der EU","Nein"] }
    ];

    const state = { step:0, answers:{}, order:[] };

    function recomputeOrder(){
      const visible = [];
      for(const q of QUESTIONS){
        const ok = !q.visibleIf || q.visibleIf(state.answers);
        if(ok){ visible.push(q); } else { delete state.answers[q.id]; }
      }
      state.order = visible;
      if(state.step >= state.order.length) state.step = Math.max(0, state.order.length-1);
    }

    function render(){
      recomputeOrder();
      const q = state.order[state.step];
      const box = document.getElementById('question');
      if(!q){ showSummary(); return; }

      const current = state.answers[q.id];
      const subtitle = (q.type==='multi') ? `<div class="hint">Mehrfachauswahl möglich</div>` : (q.subtitle?`<div class="qsub">${q.subtitle}</div>`:"");

      const opt = (label, selected) =>
        `<label class="opt ${selected?'selected':''}" data-value="${label}" role="button" tabindex="0">
           <input ${q.type==='multi'?'type="checkbox"':'type="radio"'} name="${q.id}">
           <span>${label}</span>
         </label>`;

      let optionsHTML = "";
      if(q.type==='single'){
        optionsHTML = `<div class="grid">${q.options.map(o=>opt(o,current===o)).join("")}</div>`;
      }else if(q.type==='multi'){
        const cur = Array.isArray(current)?current:[];
        optionsHTML = `<div class="grid">${q.options.map(o=>opt(o,cur.includes(o))).join("")}</div>`;
      }else if(q.type==='yesno'){
        const ys=["Ja","Nein"];
        optionsHTML = `<div class="grid">${ys.map(o=>opt(o,current===o)).join("")}</div>`;
      }

      box.innerHTML = `<div class="qhead">${q.title}</div>${subtitle||""}${optionsHTML}`;

      // Interaktion
      box.querySelectorAll('.opt').forEach(el=>{
        el.addEventListener('click', (e)=>{
          e.preventDefault();
          const value = el.dataset.value;
          if(q.type==='multi'){
            const arr = Array.isArray(state.answers[q.id]) ? [...state.answers[q.id]] : [];
            const i = arr.indexOf(value);
            (i>=0) ? arr.splice(i,1) : arr.push(value);
            state.answers[q.id] = arr;
            el.classList.toggle('selected');
          }else{
            state.answers[q.id] = value;
            box.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));
            el.classList.add('selected');
          }
          updateButtons();
        });
      });

      updateButtons();
      updateProgress();
      hideSummary();
    }

    function isRequired(q){ return q.required === true; }

    function currentAnswered(){
      const q = state.order[state.step];
      if(!q) return true;
      const v = state.answers[q.id];

      if(!isRequired(q)) return true;
      if(q.type==='multi') return Array.isArray(v) && v.length>0;
      return !!v;
    }

    function updateButtons(){
      document.getElementById('prevBtn').disabled = state.step===0;
      document.getElementById('nextBtn').disabled = !currentAnswered();
    }

    function updateProgress(){
      const total = Math.max(1, state.order.length);
      const pct = Math.round((state.step)/total*100);
      document.getElementById('bar').style.width = `${pct}%`;
    }

    function showSummary(){
      document.getElementById('question').classList.add('hidden');
      document.querySelector('.controls').classList.add('hidden');
      const s = document.getElementById('summary'); s.style.display='block';

      // Antwortenliste
      const answered = QUESTIONS.filter(q => state.answers[q.id] !== undefined && (!q.visibleIf || q.visibleIf(state.answers)));
      document.getElementById('answers').innerHTML = answered.map(q=>{
        const v = state.answers[q.id];
        const val = Array.isArray(v)? v.join(", ") : (v ?? "—");
        return `<div class="tag"><strong>${q.title}:</strong>&nbsp; ${val}</div>`;
      }).join("");

      // Hinweis bei "Ich weiß es nicht"
      const hasUnknown = Object.values(state.answers).some(v => v==="Ich weiß es nicht" || (Array.isArray(v) && v.includes("Ich weiß es nicht")));
      document.getElementById('unknownNote').style.display = hasUnknown ? 'block' : 'none';

      // Empfehlung ausgeben
      document.getElementById('recommendation').innerHTML = buildRecommendation(state.answers);

      // Voller Balken
      document.getElementById('bar').style.width = "100%";
    }

    function hideSummary(){
      document.getElementById('summary').style.display='none';
      document.getElementById('question').classList.remove('hidden');
      document.querySelector('.controls').classList.remove('hidden');
    }

    // ——— Einfache Empfehlungslogik
    function buildRecommendation(a){
      // Groblogik PKV-Eligibility (vereinfachte Heuristik):
      const highIncome = a.income === "Über 69.300 €";
      const isStudent = a.occupation === "Auszubildender/Student";
      const pkvEligible = highIncome && !isStudent;

      // Basispfad
      let base = pkvEligible ? "PKV prüfen" : "GKV beibehalten";
      let details = [];

      // Kinder / Familienlogik (hinweisartig)
      if(a.hasChildren==="Ja" && a.insureChildren==="Ja"){
        if(a.childrenInsurance==="über eine GKV" && pkvEligible){
          details.push("Kinder: Prüfen, ob private Mitversicherung sinnvoll ist (abhängig vom anderen Elternteil & Einkommen).");
        } else if(a.childrenInsurance==="über eine GKV"){
          details.push("Kinder: Familienversicherung in der GKV i. d. R. beitragsfrei.");
        }
      }

      // Zusatzleistungen Ableitung
      const extras = a.extrasSelection || [];
      if(!pkvEligible){
        // GKV + Zusätze
        if(extras.includes("Zusätzliche Zahnleistungen")){
          const z = (a.extrasTeeth||[]).length ? ` (${(a.extrasTeeth||[]).join(", ")})` : "";
          details.push("Zahnzusatzversicherung empfohlen"+z+".");
        }
        if(extras.includes("Zusätzliche Reiseversicherungen")){
          const r = (a.extrasTravel||[]).length ? ` (${(a.extrasTravel||[]).join(", ")})` : "";
          details.push("Reiseversicherung(en) empfohlen"+r+".");
        }
        if(extras.includes("Zusätzliche Krankenhausleistungen")){
          const k = (a.extrasHospital||[]).length ? ` (${(a.extrasHospital||[]).join(", ")})` : "";
          details.push("Krankenhaus-/Ambulant-Zusätze prüfen"+k+".");
        }
      }else{
        // PKV: Zusätze oft im Tarif integrierbar
        if(extras.length){
          details.push("PKV-Tarif mit gewünschten Leistungen wählen: "+extras.join(", ") + ".");
        }else{
          details.push("PKV-Tarif mit ausgewogenem Leistungsumfang (Stationär/ Zahn / Ambulant) auswählen.");
        }
      }

      // Gesundheit / Lifestyle Hinweise
      if(a.chronicDiseases==="Ja"){
        details.push("Chronische Erkrankungen vorhanden: mit Risikozuschlägen/Annahmen in PKV rechnen; ggf. GKV + Zusatz vorteilhaft.");
      }
      if(a.dangerousSports==="Ja"){
        details.push("Gefährliche Sportarten: Leistungen für Unfälle/Stationär prüfen.");
      }
      if(a.travel && a.travel!=="Nein"){
        details.push("Regelmäßige Reisen: Auslandskrankenversicherung sinnvoll.");
      }

      // Ausgabe
      return `
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div style="min-width:10px;height:auto;background:var(--brand);border-radius:6px"></div>
          <div>
            <h3 style="margin:0 0 6px">Empfehlung</h3>
            <p style="margin:0 0 8px"><strong>${base}</strong></p>
            ${details.length? `<ul style="margin:6px 0 0 18px">${details.map(d=>`<li>${d}</li>`).join("")}</ul>` : "<p>Für eine genauere Empfehlung fehlten Angaben.</p>"}
          </div>
        </div>
      `;
    }

    // Navigation
    document.getElementById('prevBtn').addEventListener('click', ()=>{ if(state.step>0){ state.step--; render(); } });
    document.getElementById('nextBtn').addEventListener('click', ()=>{ (state.step < state.order.length-1) ? (state.step++, render()) : showSummary(); });
    document.getElementById('skipBtn').addEventListener('click', ()=>{
      const q = state.order[state.step];
      if(!isRequired(q)) state.answers[q.id] = "Ich weiß es nicht";
      (state.step < state.order.length-1) ? (state.step++, render()) : showSummary();
    });

    function restart(){
      state.step = 0;
      state.answers = {};
      state.order = [];
      document.getElementById('summary').style.display='none';
      document.getElementById('question').classList.remove('hidden');
      document.querySelector('.controls').classList.remove('hidden');
      document.getElementById('bar').style.width = "0%";
      render();
      window.scrollTo({top:0,behavior:"smooth"});
    }
    document.getElementById('restartTop').addEventListener('click', restart);
    document.getElementById('restartBottom').addEventListener('click', restart);

    // Start
    render();
  </script>
</body>
</html>
