<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Testudo – Entscheidungsassistent</title>
  <!-- Favicon / Browser-Icon -->
  <link rel="icon" href="Testudo.png" type="image/png" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap');

    :root{
      color-scheme: dark;
      --bg:#040810;
      --bg-soft:rgba(11,20,39,.78);
      --panel:rgba(12,24,50,.86);
      --text:#f2f6ff;
      --muted:#9fb2cd;
      --line:rgba(255,255,255,.08);
      --brand:#A7D37B;             /* Hauptfarbe Testudo */
      --brand-dark:#4F7A3C;
      --r-lg:26px; --r-md:18px; --r-sm:12px;
      --shadow:0 32px 80px rgba(5,11,25,.55);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:clamp(20px,4vw,48px);
      font-family:Manrope,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(circle at 15% -10%, rgba(167,211,123,.28), transparent 42%),
        radial-gradient(circle at 90% 15%, rgba(79,122,60,.35), transparent 45%),
        radial-gradient(ellipse at bottom, rgba(15,34,43,.7), transparent 60%),
        var(--bg);
      color:var(--text);
      overflow-y:auto;
      scroll-behavior:smooth;
    }
    body::before{
      content:"";
      position:fixed;inset:0;pointer-events:none;opacity:.3;mix-blend-mode:screen;z-index:0;
      background:url('data:image/svg+xml,%3Csvg width="340" height="340" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg" opacity="0.6"%3E%3Cdefs%3E%3ClinearGradient id="g" x1="0" y1="0" x2="1" y2="1"%3E%3Cstop offset="0" stop-color="%23A7D37B"/%3E%3Cstop offset="1" stop-color="%234F7A3C"/%3E%3C/linearGradient%3E%3C/defs%3E%3Cg fill="none" stroke="url(%23g)" stroke-width="0.7" opacity="0.18"%3E%3Cpath d="M5 80c30-32 120-32 150 0"/%3E%3Cpath d="M5 110c30-32 120-32 150 0"/%3E%3Cpath d="M5 50c30-32 120-32 150 0"/%3E%3C/g%3E%3C/svg%3E') center/540px 540px no-repeat;
    }

    .shell{
      width:min(1100px,100%);
      display:flex;
      flex-direction:column;
      gap:32px;
      position:relative;
      z-index:1;
    }

    .masthead{
      display:flex;
      gap:24px;
      align-items:center;
      justify-content:space-between;
      padding:clamp(24px,5vw,36px);
      background:var(--bg-soft);
      backdrop-filter:blur(26px);
      border:1px solid rgba(255,255,255,.05);
      border-radius:var(--r-lg);
      box-shadow:var(--shadow);
    }
    .brand{display:flex;gap:18px;align-items:center}
    .logo-img{
      width:160px;
      height:auto;
      border-radius:16px;
      object-fit:contain;
      display:block;
      border:1px solid rgba(255,255,255,.12);
      background:#0d1720;
      padding:6px;
    }
    .eyebrow{
      text-transform:uppercase;
      letter-spacing:.24em;
      font-size:.7rem;
      color:rgba(255,255,255,.7);
      margin:0 0 6px;
    }
    .headline{
      margin:0;
      font-size:clamp(1.9rem,4vw,2.5rem);
      font-weight:800;
      letter-spacing:-.01em;
    }
    .lede{
      margin:10px 0 0;
      max-width:520px;
      color:var(--muted);
      font-size:1rem;
      line-height:1.6;
    }
    .meta-grid{
      display:grid;
      gap:10px;
      grid-template-columns:repeat(2,minmax(0,1fr));
      text-align:right;
    }
    .stat{
      padding:10px 14px;
      border-radius:var(--r-sm);
      border:1px solid var(--line);
      background:rgba(10,20,38,.85);
      color:var(--muted);
      font-size:.85rem;
    }

    .app{
      background:var(--panel);
      border-radius:var(--r-lg);
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.05);
      overflow:hidden;
    }
    .app-header{
      padding:clamp(20px,5vw,32px) clamp(24px,6vw,40px) clamp(14px,3vw,20px);
      border-bottom:1px solid rgba(255,255,255,.06);
      background:linear-gradient(160deg,rgba(9,28,32,.9),rgba(8,20,32,.8));
    }
    .label{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 12px;border-radius:999px;
      font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;
      background:rgba(167,211,123,.12);color:var(--brand);
      border:1px solid rgba(167,211,123,.5);
    }
    .wizard-title{margin:12px 0 6px;font-size:clamp(1.4rem,3vw,1.8rem);font-weight:800}
    .wizard-subtitle{margin:0;color:var(--muted);max-width:560px;line-height:1.6;font-size:.96rem}
    .progress{
      height:9px;margin-top:22px;background:rgba(255,255,255,.08);
      border-radius:999px;overflow:hidden;position:relative;
    }
    .bar{
      height:100%;width:0;
      background:linear-gradient(90deg,var(--brand),var(--brand-dark));
      border-radius:inherit;
      transition:width .3s ease;
      box-shadow:0 0 18px rgba(167,211,123,.55);
    }

    main{padding:clamp(24px,5vw,40px)}
    .qhead{
      font-size:clamp(1.2rem,2.7vw,1.6rem);
      font-weight:700;
      margin:0 0 14px;
      letter-spacing:-.01em;
    }
    .qsub{
      color:var(--muted);
      margin:0 0 18px;
      font-size:.93rem;
      line-height:1.6;
    }
    .multi-hint{
      display:inline-block;
      margin-top:4px;
      font-size:.82rem;
      color:var(--brand);
      text-transform:uppercase;
      letter-spacing:.12em;
    }

    .grid{
      display:grid;
      gap:14px;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    }
    .opt{
      border-radius:var(--r-md);
      padding:16px;
      background:rgba(7,15,32,.72);
      border:1px solid var(--line);
      cursor:pointer;
      user-select:none;
      transition:transform .16s ease,border-color .16s ease,box-shadow .16s ease,background .16s ease;
      position:relative;
      overflow:hidden;
    }
    .opt::after{
      content:"";
      position:absolute;inset:-60% -10%;
      background:radial-gradient(circle,rgba(167,211,123,.22),transparent 60%);
      opacity:0;transition:opacity .16s ease;
      pointer-events:none;
    }
    .opt:hover{
      transform:translateY(-3px);
      border-color:rgba(167,211,123,.7);
      box-shadow:0 16px 28px rgba(5,12,26,.55);
      background:rgba(8,18,34,.9);
    }
    .opt:hover::after{opacity:1}
    .opt.selected{
      border:1px solid rgba(167,211,123,.9);
      box-shadow:0 0 0 1px rgba(167,211,123,.6);
      background:linear-gradient(145deg,rgba(167,211,123,.25),rgba(17,35,45,.9));
    }
    .opt input{display:none}
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      font-size:.97rem;
      letter-spacing:-.01em;
    }

    .info-icon{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:18px;
      height:18px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.35);
      font-size:.7rem;
      font-weight:700;
      color:var(--muted);
      cursor:help;
      background:rgba(7,15,30,.9);
    }

    .controls{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      margin-top:26px;
      flex-wrap:wrap;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      padding:11px 16px;
      border-radius:var(--r-sm);
      border:1px solid var(--line);
      background:rgba(6,15,30,.8);
      color:var(--text);
      cursor:pointer;
      font-weight:700;
      font-size:.92rem;
      transition:transform .14s ease,border-color .14s ease,background .14s ease,box-shadow .14s ease;
    }
    .btn:hover:not([disabled]){
      transform:translateY(-1px);
      border-color:rgba(167,211,123,.8);
      background:rgba(10,20,38,.95);
      box-shadow:0 10px 20px rgba(3,8,18,.7);
    }
    .btn[disabled]{opacity:.45;cursor:default;transform:none;box-shadow:none}
    .btn.primary{
      border:none;
      background:linear-gradient(120deg,var(--brand),var(--brand-dark));
      color:#041209;
      box-shadow:0 14px 26px rgba(4,12,6,.7);
    }
    .btn.ghost{
      background:transparent;
      border-color:rgba(255,255,255,.18);
      color:var(--muted);
    }

    .summary{display:none;margin-top:30px}
    .summary h2{margin:0 0 14px;font-size:1.3rem}

    .summary-group-title{
      margin:18px 0 6px;
      font-size:1.05rem;
      color:var(--brand);
      font-weight:700;
    }
    .summary-group{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    #answers{margin-top:6px;}

    .tag{
      display:inline-flex;align-items:center;gap:6px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(8,19,36,.9);
      border:1px solid var(--line);
      font-size:.88rem;
    }
    .hr{height:1px;background:var(--line);margin:18px 0}
    .help{font-size:.9rem;color:var(--muted);line-height:1.6}
    .warning{
      margin-top:10px;
      padding:10px 12px;
      border-radius:var(--r-sm);
      background:rgba(173,68,68,.16);
      border:1px solid rgba(255,140,140,.7);
      color:#ffd7d7;
      font-size:.9rem;
    }

    .recommend-box{
      margin:10px 0 18px;
      padding:14px 16px;
      border-radius:var(--r-md);
      background:rgba(7,18,24,.95);
      border:1px solid rgba(167,211,123,.8);
    }
    .recommend-header{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:8px;
    }
    .recommend-logo{
      width:40px;
      height:40px;
      border-radius:10px;
      object-fit:contain;
      border:1px solid rgba(255,255,255,.2);
      background:#0d1720;
      padding:3px;
    }
    .recommend-title{
      font-weight:800;
      color:var(--brand);
      font-size:1.05rem;
      margin-bottom:2px;
    }
    .recommend-base{
      font-weight:600;
      font-size:.95rem;
    }
    .recommend-details{
      font-size:.9rem;
      margin-top:6px;
      color:var(--muted);
    }

    .footer-note{margin-top:22px;color:rgba(255,255,255,.55);font-size:.84rem}
    .hidden{display:none !important}

    @media (max-width:960px){
      .masthead{flex-direction:column;align-items:flex-start}
      .meta-grid{width:100%;grid-template-columns:1fr;text-align:left}
    }
    @media (max-width:640px){
      body{padding:16px}
      .grid{grid-template-columns:1fr}
      .controls{flex-direction:column;align-items:stretch}
      .row{width:100%;flex-direction:column}
      .btn,.row .btn{width:100%;text-align:center}
    }
  </style>
</head>
<body>
  <div class="shell">
    <header class="masthead">
      <div class="brand">
        <!-- Logo-Pfad ggf. anpassen -->
        <img class="logo-img" src="Testudo.png" alt="Testudo Logo">
        <div>
          <p class="eyebrow">Testudo</p>
          <h1 class="headline">Conversational UI for Insurance</h1>
          <p class="lede">
            Testudo unterstützt Versicherungsinteressenten dabei, strukturiert durch Gesundheits- und Lebensfragen geführt zu werden,
            um passende Versicherungsoptionen im Gesundheitsbereich zu identifizieren.
          </p>
        </div>
      </div>
      <div class="meta-grid">
        <div class="stat">Developed by: Kaan · Kadir · Cetin · Mustafa</div>
        <div class="stat">Testudo Projektdummy</div>
      </div>
    </header>

    <div class="app" id="app">
      <div class="app-header">
        <span class="label">Onboarding Wizard</span>
        <h2 class="wizard-title">Ihre Antworten führen zur Empfehlung</h2>
        <p class="wizard-subtitle">
          Beantworten Sie die folgenden Fragen. Sie können jederzeit zurückspringen oder eine Frage überspringen.
          Am Ende erhalten Sie eine Empfehlung sowie einen Hinweis, wenn Angaben unklar geblieben sind.
        </p>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>

      <main>
        <div id="question"></div>

        <div class="controls">
          <button class="btn ghost" id="restartBtn">Neu starten</button>
          <div class="row">
            <button class="btn" id="prevBtn">Zurück</button>
            <button class="btn" id="skipBtn">Ich weiß es nicht</button>
            <button class="btn primary" id="nextBtn">Weiter</button>
          </div>
        </div>

        <section class="summary" id="summary">
          <h2>Ihre Angaben & Empfehlung</h2>
          <div id="recommendation"></div>
          <div id="unknownWarning" class="warning hidden">
            Einige Fragen wurden mit <strong>„Ich weiß es nicht“</strong> beantwortet.
            Für eine verlässliche Entscheidung sollten Sie diese Fragen neu beantworten
            oder gemeinsam mit einer Fachperson besprechen.
          </div>
          <div class="hr"></div>
          <div id="answers"></div>
          <div class="hr"></div>
          <p class="help">
            Dieses UI dient als Konzept-Dummy. Die endgültige Tarif- und Produktempfehlung würde in einer realen Anwendung anhand realer Tarife
            und weiterer Kriterien automatisiert berechnet.
          </p>
          <button class="btn ghost" id="restartSummaryBtn">Fragen erneut durchgehen</button>
        </section>

        <div class="footer-note">
          Testudo – Projektdummy
        </div>
      </main>
    </div>
  </div>

  <script>
    // Fragenkatalog mit Kategorien
    const QUESTIONS = [
      // Persönliche Angaben
      { id:"age", title:"Wie alt sind Sie?", type:"single", required:true, category:"personal",
        options:["18–29","30–39","40–59","ab 60"] },

      { id:"occupation", title:"Was ist Ihr aktueller Beruf?", type:"single", required:true, category:"personal",
        options:["Beamter","Selbstständig","Angestellter","Auszubildender/Student","Arbeitslos","Rente"] },

      { id:"income", title:"Wie hoch ist Ihr jährliches Bruttoeinkommen?", type:"single", required:true, category:"personal",
        options:["Unter 20.000 €","20.001–40.000 €","40.001–69.299 €","Über 69.300 €"] },

      { id:"jobIntensity", title:"Wie körperlich intensiv ist Ihr Beruf?", type:"single", required:false, category:"personal",
        options:["überwiegend sitzend","teilweise körperlich","stark körperlich"] },

      // Zusatzleistungen
      { id:"extrasImportance", title:"Sind Ihnen Zusatzleistungen wichtig?", type:"yesno", required:false, category:"extras" },

      { id:"extrasSelection", title:"Welche Zusatzleistungen sind Ihnen wichtig?", type:"multi", required:false, category:"extras",
        visibleIf:a => a.extrasImportance === "Ja",
        options:["Zusätzliche Zahnleistungen","Zusätzliche Reiseversicherungen","Zusätzliche Krankenhausleistungen"] },

      { id:"extrasDental", title:"Welche zusätzlichen Zahnleistungen sind Ihnen wichtig?", type:"multi", required:false, category:"extras",
        visibleIf:a => Array.isArray(a.extrasSelection) && a.extrasSelection.includes("Zusätzliche Zahnleistungen"),
        options:["Zahnersatz","Prophylaxe","Zahnreinigung","Zahnfüllung","Zahnimplantate"] },

      { id:"extrasTravel", title:"Welche zusätzlichen Reiseversicherungen sind Ihnen wichtig?", type:"multi", required:false, category:"extras",
        visibleIf:a => Array.isArray(a.extrasSelection) && a.extrasSelection.includes("Zusätzliche Reiseversicherungen"),
        options:["Reiserücktrittsversicherung","Reiseabbruchversicherung","Auslandskrankenversicherung","Reisegepäckversicherung","Reisehaftpflichtversicherung","Reiseunfallversicherung"] },

      { id:"extrasHospital", title:"Welche zusätzlichen Krankenhausleistungen sind Ihnen wichtig?", type:"multi", required:false, category:"extras",
        visibleIf:a => Array.isArray(a.extrasSelection) && a.extrasSelection.includes("Zusätzliche Krankenhausleistungen"),
        options:["Krankenhaus-Komfort","Sehhilfen & Brille","Heilmethoden","Pflegevorsorge","Ambulant & Prävention"] },

      // Kinder / Familie (persönlich & extras)
      { id:"maritalStatus", title:"Wie ist Ihr Familienstand?", type:"single", required:true, category:"personal",
        options:["Ledig","In Partnerschaft","Verheiratet","Geschieden","Verwitwet"] },

      { id:"hasChildren", title:"Haben Sie Kinder?", type:"yesno", required:true, category:"personal" },

      { id:"insureChildren", title:"Sollen Kinder mitversichert werden?", type:"yesno", required:false, category:"personal",
        visibleIf:a => a.hasChildren==="Ja" },

      { id:"childrenAge", title:"Wie alt ist / sind Ihr(e) Kind(er)?", type:"multi", required:false, category:"personal",
        visibleIf:a => a.insureChildren==="Ja",
        options:["unter 6 Jahre","6–17 Jahre","18–25 Jahre","über 25 Jahre"] },

      { id:"childrenEducation", title:"Befinden sich Ihre Kinder in Ausbildung oder Studium?", type:"single", required:false, category:"personal",
        visibleIf:a => a.insureChildren==="Ja",
        options:["In der Schule","In Ausbildung","Im Studium","Nein"] },

      { id:"childrenInsurance", title:"Wie sind Ihre Kinder derzeit versichert?", type:"single", required:false, category:"personal",
        visibleIf:a => a.insureChildren==="Ja",
        options:["über eine GKV","über eine PKV","aktuell nicht versichert"] },

      { id:"childrenBenefits", title:"Welche Leistungen sind Ihnen für Ihre Kinder wichtig?", type:"multi", required:false, category:"extras",
        visibleIf:a => a.insureChildren==="Ja",
        options:["Zusätzliche Zahnleistungen","Zusätzliche Reiseversicherungen","Zusätzliche Krankenhausleistungen","Ich weiß es nicht"] },

      // Gesundheitssituation
      { id:"specialistTreatment", title:"Sind Sie in regelmäßiger fachärztlicher Behandlung?", type:"yesno", required:false, category:"health" },

      { id:"treatmentReason", title:"Erfolgt die fachärztliche Behandlung überwiegend aus Behandlungs- oder Vorsorgegründen?", type:"single", required:false, category:"health",
        visibleIf:a => a.specialistTreatment==="Ja",
        options:["Überwiegend Behandlungsgründe","Überwiegend Vorsorgegründe","Beides in etwa gleich"] },

      { id:"chronicDiseases", title:"Haben Sie chronische Erkrankungen?", type:"yesno", required:false, category:"health" },

      { id:"chronicDiseaseTypes", title:"Welche chronischen Erkrankungen liegen vor?", type:"multi", required:false, category:"health",
        visibleIf:a => a.chronicDiseases==="Ja",
        options:[
          "Bluthochdruck / Herz-Kreislauf",
          "Diabetes / Stoffwechsel",
          "Asthma / Atemwege",
          "Depression / psychische Erkrankung",
          "Rücken-/Gelenkbeschwerden",
          "Autoimmunerkrankung",
          "Verdauungs-/Lebererkrankung",
          "Nierenerkrankung",
          "Krebs/Tumor (auch in Remission)"
        ] },

      { id:"careDegree", title:"Haben Sie einen Pflegegrad oder eine anerkannte Behinderung?", type:"yesno", required:false, category:"health" },

      { id:"careDegreeLevel", title:"Welcher Pflegegrad liegt vor?", type:"single", required:false, category:"health",
        visibleIf:a => a.careDegree==="Ja",
        options:["1","2","3","4","5"] },

      // Lifestyle
      { id:"travel", title:"Reisen Sie regelmäßig?", type:"single", required:false, category:"lifestyle",
        options:["Ja, innerhalb der EU","Ja, außerhalb der EU","Nein"] },

      { id:"travelRegions", title:"In welche Regionen reisen Sie?", type:"multi", required:false, category:"lifestyle",
        visibleIf:a => a.travel==="Ja, innerhalb der EU" || a.travel==="Ja, außerhalb der EU",
        options:["USA / Kanada","Afrika","Naher Osten","Asien / Australien","Südamerika"] },

      { id:"dangerousSports", title:"Üben Sie gefährliche Sportarten aus?", type:"yesno", required:false, category:"lifestyle" },

      {
        id:"sportsTypes",
        title:"Welche Art von Sport üben Sie aus?",
        type:"multi",
        required:false,
        category:"lifestyle",
        visibleIf:a => a.dangerousSports==="Ja",
        options:[
          {
            value:"Hohes Risiko",
            label:"Hohes Risiko",
            info:"z. B. Freeclimbing, Basejumping, Fallschirmspringen, Motocross"
          },
          {
            value:"Mittleres Risiko",
            label:"Mittleres Risiko",
            info:"z. B. Skifahren (Off-Piste), Reitsport, Kampfsportarten"
          },
          {
            value:"Geringes Risiko",
            label:"Geringes Risiko",
            info:"z. B. Joggen, Fitnessstudio, Yoga, Schwimmen"
          }
        ]
      },

      { id:"smoking", title:"Rauchen Sie Zigaretten oder ähnliche Tabakwaren?", type:"single", required:false, category:"lifestyle",
        options:["Ja","Gelegentlich","Nein"] },

      { id:"smokingType", title:"Was rauchen Sie überwiegend?", type:"single", required:false, category:"lifestyle",
        visibleIf:a => a.smoking==="Ja" || a.smoking==="Gelegentlich",
        options:["Cannabis","Zigaretten","Cannabis und Zigaretten"] },

      { id:"medicalCannabis", title:"Nutzen Sie Cannabis auf Rezept?", type:"yesno", required:false, category:"lifestyle",
        visibleIf:a => a.smokingType==="Cannabis" || a.smokingType==="Cannabis und Zigaretten" }
    ];

    const state = { step:0, answers:{}, order:[] };

    function recomputeOrder(){
      const visible = [];
      for(const q of QUESTIONS){
        const v = (typeof q.visibleIf === "function") ? !!q.visibleIf(state.answers) : true;
        if(v){
          visible.push(q);
        }else{
          delete state.answers[q.id];
        }
      }
      state.order = visible;
      if(state.step >= state.order.length){
        state.step = Math.max(0, state.order.length-1);
      }
    }

    function render(){
      recomputeOrder();
      const q = state.order[state.step];
      const container = document.getElementById('question');

      if(!q){
        showSummary();
        return;
      }

      const current = state.answers[q.id];
      const multiHint = (q.type === "multi")
        ? `<div class="multi-hint">Mehrfachauswahl möglich</div>`
        : "";

      // Option-Renderer, unterstützt Strings & Objekte (für Tooltips)
      function renderOption(option, selected){
        let value, label, info;
        if(typeof option === "string"){
          value = label = option;
          info = null;
        }else{
          value = option.value;
          label = option.label;
          info = option.info || null;
        }
        const infoHtml = info
          ? `<span class="info-icon" title="${info}">i</span>`
          : "";
        return `
          <label class="opt ${selected ? "selected" : ""}" data-value="${value}">
            <input type="${q.type === "multi" ? "checkbox" : "radio"}" name="${q.id}" />
            <span class="pill">
              <span>${label}</span>
              ${infoHtml}
            </span>
          </label>
        `;
      }

      let optionsHTML = "";
      if(q.type === "single"){
        optionsHTML = `<div class="grid">${
          q.options.map(o => renderOption(o, current === (typeof o === "string" ? o : o.value))).join("")
        }</div>`;
      }else if(q.type === "multi"){
        const cur = Array.isArray(current) ? current : [];
        optionsHTML = `<div class="grid">${
          q.options.map(o => {
            const value = (typeof o === "string") ? o : o.value;
            return renderOption(o, cur.includes(value));
          }).join("")
        }</div>`;
      }else if(q.type === "yesno"){
        const ys = ["Ja","Nein"];
        optionsHTML = `<div class="grid">${
          ys.map(o => renderOption(o, current === o)).join("")
        }</div>`;
      }

      container.innerHTML = `
        <div class="qhead">${q.title}</div>
        <div class="qsub">
          ${q.subtitle ? q.subtitle : ""}
          ${multiHint}
        </div>
        ${optionsHTML}
      ";

      // Klicklogik inkl. Mehrfachauswahl
      container.querySelectorAll('.opt').forEach(el=>{
        el.addEventListener('click', (e)=>{
          e.preventDefault();
          const value = el.dataset.value;
          if(q.type === "multi"){
            const existing = Array.isArray(state.answers[q.id]) ? [...state.answers[q.id]] : [];
            const idx = existing.indexOf(value);
            if(idx >= 0){
              existing.splice(idx,1);
            }else{
              existing.push(value);
            }
            state.answers[q.id] = existing;
            el.classList.toggle('selected');
          }else{
            state.answers[q.id] = value;
            container.querySelectorAll('.opt').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
          }
          updateButtons();
        });
      });

      updateButtons();
      updateProgress();
      hideSummary();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function isRequired(q){ return q.required === true; }

    function currentAnswered(){
      const q = state.order[state.step];
      if(!q) return true;
      const v = state.answers[q.id];

      if(!isRequired(q)) return true; // optionale Fragen blockieren "Weiter" nicht

      if(q.type === "multi"){
        return Array.isArray(v) && v.length > 0;
      }
      return !!v;
    }

    function updateButtons(){
      document.getElementById('prevBtn').disabled = state.step === 0;
      document.getElementById('nextBtn').disabled = !currentAnswered();
    }

    function updateProgress(){
      const total = Math.max(1, state.order.length);
      const pct = Math.round((state.step) / total * 100);
      document.getElementById('bar').style.width = `${pct}%`;
    }

    // Empfehlungslogik
    function buildRecommendation(answers){
      let baseText = "";
      const details = [];

      const income = answers.income;
      const chronic = answers.chronicDiseases === "Ja";
      const care = answers.careDegree === "Ja";
      const wantsExtras = answers.extrasImportance === "Ja";
      const extras = Array.isArray(answers.extrasSelection) ? answers.extrasSelection : [];
      const travels = answers.travel && answers.travel !== "Nein";
      const hasKids = answers.hasChildren === "Ja";
      const insureKids = answers.insureChildren === "Ja";

      const highIncome = income === "Über 69.300 €";
      const midIncome = income === "40.001–69.299 €";

      if(highIncome && !care){
        baseText = "eine private Krankenversicherung (PKV) – unter genauer Prüfung der gesundheitlichen Situation.";
        details.push("Durch Ihr Einkommen besteht grundsätzlich die Möglichkeit, in die PKV zu wechseln. Wichtig sind dabei Gesundheitszustand, Familienplanung und die langfristige Beitragsentwicklung.");
      }else if(chronic || care){
        baseText = "die gesetzliche Krankenversicherung (GKV) als stabile Basis.";
        details.push("Aufgrund bestehender gesundheitlicher Einschränkungen kann die GKV als verlässliche und solidarisch finanzierte Basis sinnvoller sein als ein Wechsel in die PKV.");
      }else if(midIncome){
        baseText = "die GKV mit gut abgestimmten Zusatzversicherungen.";
        details.push("Mit Ihrem Einkommen kann eine starke GKV-Basis kombiniert mit ausgewählten Zusatzleistungen (z. B. Zahn, Krankenhaus, Reisen) ein ausgewogenes Preis-Leistungs-Verhältnis bieten.");
      }else{
        baseText = "die GKV mit gezielten Zusatzversicherungen, passend zu Ihrem Bedarf.";
        details.push("Gerade bei geringerem Einkommen ist die GKV als Basis sinnvoll. Einzelne Zusatzbausteine können gezielt Lücken schließen, ohne die monatliche Belastung zu stark zu erhöhen.");
      }

      if(wantsExtras || extras.length > 0){
        if(extras.includes("Zusätzliche Zahnleistungen")){
          details.push("Eine Zahnzusatzversicherung kann die Eigenanteile bei Zahnersatz, Prophylaxe und professioneller Zahnreinigung deutlich reduzieren.");
        }
        if(extras.includes("Zusätzliche Reiseversicherungen") || travels){
          details.push("Bei regelmäßigen Reisen empfiehlt sich eine Auslandskrankenversicherung und – je nach Reisetyp – eine Rücktritts- bzw. Abbruchversicherung.");
        }
        if(extras.includes("Zusätzliche Krankenhausleistungen")){
          details.push("Krankenhauszusatzleistungen (Komfort, Wahlleistungen) können Ihnen im stationären Fall mehr Wahlfreiheit und Komfort bieten.");
        }
      }

      if(hasKids && insureKids){
        details.push("Für Kinder können insbesondere Zahn- und Krankenhauszusatzversicherungen relevant sein – abhängig vom aktuellen Versicherungsstatus und der geplanten Laufzeit.");
      }

      return { baseText, details };
    }

    function showSummary(){
      document.getElementById('question').classList.add('hidden');
      document.querySelector('.controls').classList.add('hidden');
      const s = document.getElementById('summary');
      const answersBox = document.getElementById('answers');
      const recBox = document.getElementById('recommendation');
      const unknownWarning = document.getElementById('unknownWarning');

      s.style.display = "block";

      const answered = QUESTIONS.filter(q => {
        if(state.answers[q.id] === undefined) return false;
        if(typeof q.visibleIf === "function"){
          return !!q.visibleIf(state.answers);
        }
        return true;
      });

      let hasUnknown = false;

      const groupsConfig = [
        { id:"personal",  title:"Persönliche Angaben" },
        { id:"extras",    title:"Zusatzleistungen" },
        { id:"health",    title:"Gesundheitssituation" },
        { id:"lifestyle", title:"Lifestyle" }
      ];
      const groupHtml = {};
      groupsConfig.forEach(g => groupHtml[g.id] = []);

      answered.forEach(q => {
        const v = state.answers[q.id];
        let val = Array.isArray(v) ? v.join(", ") : v;
        if(val === undefined || val === null || val === "") val = "—";
        if(val === "Ich weiß es nicht" || (Array.isArray(v) && v.includes("Ich weiß es nicht"))){
          hasUnknown = true;
        }
        const tag = `<div class="tag"><strong>${q.title}:</strong>&nbsp; ${val}</div>`;
        const cat = q.category || "personal";
        if(!groupHtml[cat]) groupHtml[cat] = [];
        groupHtml[cat].push(tag);
      });

      const groupsMarkup = groupsConfig
        .map(g => {
          const items = groupHtml[g.id];
          if(!items || items.length === 0) return "";
          return `
            <h3 class="summary-group-title">${g.title}</h3>
            <div class="summary-group">
              ${items.join("")}
            </div>
          `;
        })
        .join("");

      answersBox.innerHTML = groupsMarkup || "<p class='help'>Es liegen noch keine Antworten vor.</p>";

      const { baseText, details } = buildRecommendation(state.answers);
      recBox.innerHTML = `
        <div class="recommend-box">
          <div class="recommend-header">
            <img src="Testudo.png" alt="Testudo Logo" class="recommend-logo" />
            <div>
              <div class="recommend-title">Testudo empfiehlt</div>
              <div class="recommend-base">${baseText}</div>
            </div>
          </div>
          <div class="recommend-details">
            ${details.map(d => `<div>• ${d}</div>`).join("")}
          </div>
        </div>
      `;

      if(hasUnknown){
        unknownWarning.classList.remove('hidden');
      }else{
        unknownWarning.classList.add('hidden');
      }

      document.getElementById('bar').style.width = "100%";
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function hideSummary(){
      document.getElementById('summary').style.display = "none";
      document.getElementById('question').classList.remove('hidden');
      document.querySelector('.controls').classList.remove('hidden');
    }

    function restartWizard(){
      state.step = 0;
      state.answers = {};
      recomputeOrder();
      render();
    }

    // Buttons
    document.getElementById('prevBtn').addEventListener('click', ()=>{
      if(state.step > 0){
        state.step--;
        render();
      }
    });

    document.getElementById('nextBtn').addEventListener('click', ()=>{
      if(state.step < state.order.length - 1){
        state.step++;
        render();
      }else{
        showSummary();
      }
    });

    document.getElementById('skipBtn').addEventListener('click', ()=>{
      const q = state.order[state.step];
      state.answers[q.id] = "Ich weiß es nicht";
      if(state.step < state.order.length - 1){
        state.step++;
        render();
      }else{
        showSummary();
      }
    });

    document.getElementById('restartBtn').addEventListener('click', restartWizard);
    document.getElementById('restartSummaryBtn').addEventListener('click', restartWizard);

    // Start
    render();
  </script>
</body>
</html>
